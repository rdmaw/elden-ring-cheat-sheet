const key="er",D="default",root=document.documentElement,def={[D]:{data:{},col:{}}};let A=localStorage.getItem("current")||D,p=initProfile();function initProfile(){try{const e=JSON.parse(localStorage.getItem(key))??def;return e[D]={...def[D],...e[D]},localStorage.setItem(key,JSON.stringify(e)),e}catch(e){return console.error("Error initializing profile:",e),def}}const mgr={get:()=>p[A]||p[D],setCl(e,t){e&&(p[A]||(p[A]={data:{},col:{}}),t?p[A].data[e]=1:delete p[A].data[e],localStorage.setItem(key,JSON.stringify(p)))},setCol(e,t){e&&(p[A]||(p[A]={data:{},col:{}}),p[A].col||(p[A].col={}),t?delete p[A].col[e]:p[A].col[e]=1,localStorage.setItem(key,JSON.stringify(p)))},setBatch(e){e?.length&&(p[A]||(p[A]={data:{},col:{}}),p[A].col||(p[A].col={}),e.forEach(({id:e,expanded:t})=>{e&&(t?delete p[A].col[e]:p[A].col[e]=1)}),localStorage.setItem(key,JSON.stringify(p)))},col(){return this.get().col||{}}};function restoreCheckboxes(){const{data:e}=mgr.get();document.querySelectorAll('input[type="checkbox"]').forEach(t=>{const o=!!e[t.id];t.checked=o,t.closest("li").classList.toggle("c",o)})}function calculateTotals(){const e=document.querySelector('input[type="checkbox"]');if(!e)return;const t=e.id.charAt(0),o=document.getElementById(`${t}-ot`);if(!o)return;const n=document.querySelectorAll(`span[id^="${t}-t"]`),r=Array.from(document.querySelectorAll('input[type="checkbox"]')).reduce((e,t)=>{const o=t.id.match(/^[wnqmbaerhskcp](\d+)-/)[1];return e.has(o)?e.get(o).push(t):e.set(o,[t]),e},new Map);let a=0,l=0;n.forEach(e=>{const o=e.id.match(/t(\d+)$/)[1],n=document.getElementById(`${t}-nt${o}`),c=r.get(o)||[],s=c.filter(e=>e.checked).length,i=c.length,d=i?s===i?"DONE":`${s}/${i}`:"0/0",u=s===i&&i>0;[e,n].forEach(e=>{e&&(e.classList.remove("d"),e.textContent=d,u&&e.classList.add("d"))}),a+=s,l+=i}),o.classList.remove("d"),o.textContent=l?a===l?"DONE":`${a}/${l}`:"0/0",a===l&&l>0&&o.classList.add("d")}document.addEventListener("change",e=>{if(e.target.matches('input[type="checkbox"]')){const t=e.target,o=t.checked;t.closest("li").classList.toggle("c",o),mgr.setCl(t.id,t.checked),calculateTotals()}}),window.addEventListener("pageshow",e=>{e.persisted&&(console.log("Event persisted"),window.location.reload())}),document.addEventListener("DOMContentLoaded",()=>{restoreCheckboxes(),calculateTotals(),window.addEventListener("storage",e=>{if(e.key===key||"current"===e.key)try{e.key===key?p=JSON.parse(e.newValue):"current"===e.key&&(A=e.newValue||D,s?.()),restoreCheckboxes(),calculateTotals()}catch(e){console.error("Error syncing profile:",e)}else if("h"===e.key){const t="1"===e.newValue;if(root.classList.toggle("hide",t),b){b.querySelector("span").textContent=t?"Show Completed":"Hide Completed"}}});const e=document.querySelectorAll('a[href^="http"]');for(let t=0,o=e.length;t<o;t++){const o=e[t];o.target="_blank",o.rel="noopener noreferrer"}const t=document.getElementById("theme"),o=document.getElementById("cb");if(t&&(t.value=localStorage.getItem("t")||"l",t.addEventListener("change",()=>{const e="d"===t.value;root.classList.toggle("dark",e),localStorage.setItem("t",t.value)})),o){const e=["pro","deu","tri","ach"],t=()=>{const t=o.value;root.classList.remove(...e),"0"!==t&&root.classList.add(t),localStorage.setItem("cb",t)};o.value=localStorage.getItem("cb")||"0",t(),o.addEventListener("change",t)}const n=document.getElementById("profile"),r=document.getElementById("add"),a=document.getElementById("edit"),l=document.getElementById("ngp"),c=document.getElementById("del");function s(){n&&(n.innerHTML="",n.add(new Option("Default",D)),Object.keys(p).sort().filter(e=>e!==D).forEach(e=>n.add(new Option(e,e))),n.value=A)}s(),n?.addEventListener("change",()=>{const e=n.value||D;A=e,e===D?localStorage.removeItem("current"):localStorage.setItem("current",e),p[e]||(p[e]={data:{},col:{}})}),r?.addEventListener("click",()=>{const e=prompt("Enter a name for your profile:")?.trim();e&&("default"===e.toLowerCase()||p[e]?alert("default"===e.toLowerCase()?"Profile name cannot be default.":"Profile already exists."):(p[e]={data:{},col:{}},A=e,localStorage.setItem(key,JSON.stringify(p)),localStorage.setItem("current",e),n.value=e,s()))}),a?.addEventListener("click",()=>{const e=n.value;if(e===D)return void alert("Cannot edit default profile.");const t=prompt(`Enter a new name for "${e}":`,e)?.trim();if(!t||t===e)return;if("default"===t.toLowerCase()||p[t])return void alert("default"===t.toLowerCase()?"Cannot use default as profile name.":"Profile already exists.");const o=p[e];delete p[e],p[t]=o,A=t,localStorage.setItem(key,JSON.stringify(p)),localStorage.setItem("current",t),s()}),l?.addEventListener("click",()=>{const e=n.value;if(!confirm("Starting NG+ will reset all current progress in the Walkthrough, Questlines, Bosses and New Game+ sheets."))return;const t=["w","n","q","b","p"],o=Object.entries(p[e].data).reduce((e,[o,n])=>(t.includes(o.charAt(0))||(e[o]=n),e),{});p[e].data=o,localStorage.setItem(key,JSON.stringify(p))}),c?.addEventListener("click",()=>{const e=n.value;if(confirm(`Are you sure you want to ${e===D?"reset the default profile":`delete "${e}"`}?`))if(e===D)p[D]={data:{},col:{}},localStorage.setItem(key,JSON.stringify(p));else{delete p[e],localStorage.setItem(key,JSON.stringify(p)),e===A&&(A=D,localStorage.removeItem("current"));const t=n.querySelector(`option[value="${e}"]`);t?.remove(),n.value=A}});const i=document.getElementById("imp-f"),d=document.getElementById("exp-f"),u=document.getElementById("imp-c"),m=document.getElementById("exp-c");function g(){return{current:A,[key]:p}}function f(e){if(!e?.[key]?.[D])throw new Error("Invalid profile data.");confirm("Importing a new profile will overwrite all current data.")&&(localStorage.setItem(key,JSON.stringify(e[key])),p=e[key],e.current&&(A=e.current,localStorage.setItem("current",A)),s(),alert("Successfully imported profile data."))}if(i){const e=document.createElement("input");e.type="file",e.accept=".json",e.style.display="none",i.after(e),i.addEventListener("click",()=>e.click()),e.addEventListener("change",async t=>{const o=t.target.files[0];if(o){try{const e=await o.text();f(JSON.parse(e))}catch(t){alert("Invalid profile data."),console.error(t)}e.value=""}})}d?.addEventListener("click",()=>{try{const e=new Blob([JSON.stringify(g(),null,2)],{type:"application/json"}),t=URL.createObjectURL(e),o=document.createElement("a");o.href=t,o.download="elden-ring-cheat-sheet.json",o.click(),URL.revokeObjectURL(t)}catch(e){alert("Error exporting file."),console.error(e)}}),u?.addEventListener("click",async()=>{try{const e=await navigator.clipboard.readText();f(JSON.parse(e))}catch(e){alert("Invalid clipboard data."),console.error(e)}}),m?.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(JSON.stringify(g(),null,2)),alert("Profile data copied to clipboard.")}catch(e){alert("Error copying to clipboard."),console.error(e)}});const y=document.getElementById("menu"),h=document.getElementById("sidebar"),E=h.querySelector(".close");function v(){"true"===h.ariaHidden?(h.ariaHidden="false",y.ariaExpanded="true",h.removeAttribute("inert")):(y.focus({preventScroll:!0}),h.ariaHidden="true",y.ariaExpanded="false",h.setAttribute("inert",""))}y.addEventListener("click",v),E.addEventListener("click",v),document.addEventListener("keydown",e=>{const t=document.activeElement;if(!("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName))switch(e.key.toLowerCase()){case"escape":"false"===h.ariaHidden&&v();break;case"q":e.ctrlKey||e.metaKey||(e.preventDefault(),v(),E.focus());break;case"/":if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=document.getElementById("search");t&&t.focus()}}});const S=document.getElementById("up");if(S){const e=()=>S.classList.toggle("show",window.scrollY>500);window.addEventListener("scroll",e,{passive:!0}),e(),S.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>y?.focus(),700)})}const k=document.querySelectorAll(".col"),L=document.getElementById("exp-a"),w=document.getElementById("col-a"),I=new Map;for(const e of k){const t=e.getAttribute("aria-controls"),o=document.getElementById(t);if(!o)continue;I.set(e,o);const n=!!mgr.col()[t];e.ariaExpanded=!n,o.classList.toggle("f",n),e.addEventListener("click",()=>{const n="true"!==e.ariaExpanded;e.ariaExpanded=n,o.classList.toggle("f",!n),mgr.setCol(t,n)})}document.querySelector("style[data-c]")?.remove();const C=e=>{const t=[];I.forEach((o,n)=>{const r=n.getAttribute("aria-controls");n.ariaExpanded=e,o.classList.toggle("f",!e),t.push({id:r,expanded:e})}),mgr.setBatch(t)};L?.addEventListener("click",()=>C(!0)),w?.addEventListener("click",()=>C(!1));const b=document.getElementById("hide");if(b){const e=b.querySelector("span"),t="1"===localStorage.getItem("h");root.classList.toggle("hide",t),e.textContent=t?"Show Completed":"Hide Completed",b.addEventListener("click",()=>{const t=!root.classList.contains("hide");root.classList.toggle("hide",t),e.textContent=t?"Show Completed":"Hide Completed",localStorage.setItem("h",t?"1":"0")})}const x=document.getElementById("search");x&&x.addEventListener("input",e=>function(e){const t=[...document.querySelectorAll("main h3")],o=e.toLowerCase().trim();if(!o)return void document.querySelectorAll("main h3, main li").forEach(e=>e.style.display="");const n=o.split(/\s+/),r=new Map,a=e=>(r.has(e)||r.set(e,n.every(t=>e.includes(t))),r.get(e));for(const e of t){const t=e.nextElementSibling;if(!t)continue;const o=a(e.textContent.toLowerCase());let n=o;const r=t.children;if(o)e.style.display="",t.querySelectorAll("li").forEach(e=>e.style.display="");else{for(const e of r){let t=a(e.textContent.toLowerCase());if(t)e.querySelectorAll("ul li").forEach(e=>{e.style.display=""});else{const o=e.querySelectorAll("ul li");for(const e of o)a(e.textContent.toLowerCase())?(e.style.display="",t=!0):e.style.display="none"}e.style.display=t?"":"none",n||=t}e.style.display=n?"":"none"}}}(e.target.value))});